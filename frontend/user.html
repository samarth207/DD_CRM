<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DD CRM - User Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="sidebar-logo">
      <h1>DD CRM</h1>
    </div>
    
    <div class="sidebar-nav">
      <a href="#" class="sidebar-nav-item active" data-section="dashboard">
        <i class="fas fa-chart-line"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="leads">
        <i class="fas fa-address-book"></i>
        <span>My Leads</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="brochures">
        <i class="fas fa-file-pdf"></i>
        <span>Brochures</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="analytics">
        <i class="fas fa-chart-bar"></i>
        <span>Analytics</span>
      </a>
    </div>
    
    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="sidebar-user-avatar">U</div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name" id="user-name-sidebar">User</div>
          <div class="sidebar-user-role">Sales Rep</div>
        </div>
      </div>
      <button onclick="logout()" class="btn btn-secondary" style="width: 100%;">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>
  
  <!-- Top Header -->
  <div class="top-header">
    <div class="header-title">
      <i class="fas fa-user-circle" style="margin-right: 8px; color: #6366f1;"></i>
      My Leads Dashboard
    </div>
    <div class="header-actions" style="display: flex; align-items: center; gap: 20px;">
      <!-- Notification Bell Icon -->
      <div style="position: relative; cursor: pointer;" onclick="toggleNotificationPanel()">
        <i class="fas fa-bell" id="notification-bell" style="font-size: 20px; color: #6b7280; transition: color 0.3s;"></i>
        <span id="notification-badge" style="display: none; position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 11px; font-weight: 600; display: flex; align-items: center; justify-content: center; border: 2px solid white;">0</span>
      </div>
      <span id="user-name" style="color: #6b7280; font-size: 13px; font-weight: 500;"></span>
    </div>
  </div>
  
  <div class="container with-header">
    <div class="dashboard">
      
      <!-- Quick Stats Overview -->
      <div id="dashboard-section">
        <div class="stats-grid" style="margin-bottom: 26px;">
          <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h4 style="color: rgba(255,255,255,0.9);">Total Leads</h4>
            <p id="stat-total" class="stat-number" style="color: white;">0</p>
            <small style="opacity: 0.9;">All assigned leads</small>
          </div>
          <div class="stat-card" style="background: linear-gradient(135deg, #0369a1 0%, #0284c7 100%); color: white;">
            <h4 style="color: rgba(255,255,255,0.9);">Fresh Leads</h4>
            <p id="stat-new" class="stat-number" style="color: white;">0</p>
            <small style="opacity: 0.9;">Pending first contact</small>
          </div>
          <div class="stat-card" style="background: linear-gradient(135deg, #b45309 0%, #d97706 100%); color: white;">
            <h4 style="color: rgba(255,255,255,0.9);">Follow-ups</h4>
            <p id="stat-hot" class="stat-number" style="color: white;">0</p>
            <small style="opacity: 0.9;">Requires attention</small>
          </div>
          <div class="stat-card" style="background: linear-gradient(135deg, #047857 0%, #10b981 100%); color: white;">
            <h4 style="color: rgba(255,255,255,0.9);">Enrolled</h4>
            <p id="stat-closed" class="stat-number" style="color: white;">0</p>
            <small style="opacity: 0.9;">Successfully closed</small>
          </div>
        </div>
      </div>

      <!-- Quick Actions & Recent Activity -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 26px;">
        <div class="card">
          <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 18px;">
            <i class="fas fa-clock" style="color: #6366f1;"></i>
            Recent Activity
          </h3>
          <div id="recent-activity-dashboard" style="display: flex; flex-direction: column; gap: 10px; max-height: 280px; overflow-y: auto;">
            <p style="color: #9ca3af; font-size: 14px; text-align: center; padding: 20px 0;">No recent activity</p>
          </div>
        </div>
        
        <div class="card">
          <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 18px;">
            <i class="fas fa-filter" style="color: #6366f1;"></i>
            Quick Filters
          </h3>
          <div style="display: flex; flex-direction: column; gap: 11px;">
            <button onclick="quickFilter('Fresh')" class="btn btn-secondary" style="justify-content: flex-start;">
              <i class="fas fa-star"></i> Fresh Leads
            </button>
            <button onclick="quickFilter('Follow up')" class="btn btn-secondary" style="justify-content: flex-start;">
              <i class="fas fa-phone"></i> Follow-ups
            </button>
            <button onclick="quickFilter('Request call back')" class="btn btn-secondary" style="justify-content: flex-start;">
              <i class="fas fa-phone-volume"></i> Callbacks
            </button>
            <button onclick="quickFilter('Did not pick')" class="btn btn-secondary" style="justify-content: flex-start;">
              <i class="fas fa-phone-slash"></i> Not Answered
            </button>
            <button onclick="quickFilter('')" class="btn btn-primary" style="justify-content: flex-start;">
              <i class="fas fa-list"></i> View All Leads
            </button>
          </div>
        </div>
      </div>
      
      <!-- Search & Filter Bar -->
      <div class="card" style="margin-bottom: 18px;">
        <div style="display: flex; gap: 14px; align-items: center; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 250px; position: relative;">
            <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af;"></i>
            <input type="text" id="filter-search" placeholder="Search by name, email, city, university, course..." style="width: 100%; padding: 11px 12px 11px 36px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
          </div>
          <select id="filter-status" style="padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px; min-width: 180px;">
            <option value="">All Statuses</option>
            <option value="Fresh">Fresh</option>
            <option value="Buffer fresh">Buffer fresh</option>
            <option value="Did not pick">Did not pick</option>
            <option value="Request call back">Request call back</option>
            <option value="Follow up">Follow up</option>
            <option value="Counselled">Counselled</option>
            <option value="Interested in next batch">Interested in next batch</option>
            <option value="Registration fees paid">Registration fees paid</option>
            <option value="Enrolled">Enrolled</option>
            <option value="Junk/not interested">Junk/not interested</option>
          </select>
          <button onclick="clearFilters()" class="btn btn-secondary" style="white-space: nowrap;">
            <i class="fas fa-times"></i> Clear
          </button>
        </div>
      </div>
      
      <!-- Leads List -->
      <div class="card" id="leads-section">
        <h2 style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
          <span style="display: flex; align-items: center;">
            <i class="fas fa-address-book" style="margin-right: 8px; color: #6366f1;"></i>
            My Leads
          </span>
          <span id="leads-count" style="font-size: 14px; font-weight: 500; color: #6b7280;">0 leads</span>
        </h2>
        <div id="leads-container"></div>
      </div>

      <!-- Brochures Section -->
      <div class="card" id="brochures-section" style="display:none;">
        <h2 style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 14px; margin-bottom: 18px;">
          <span style="display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-file-pdf" style="margin-right: 8px; color: #e11d48;"></i>
            Course Brochures
          </span>
          <button onclick="downloadAllBrochures()" class="btn btn-primary" style="font-size: 14px; display: flex; align-items: center; gap: 6px;">
            <i class="fas fa-download"></i>
            Download All as ZIP
          </button>
        </h2>
        
        <div style="display: flex; gap: 14px; margin-bottom: 18px; flex-wrap: wrap;">
          <select id="filter-university" style="padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px; flex: 1; min-width: 200px;">
            <option value="">Select University</option>
          </select>
        </div>
        
        <div id="brochures-list">
          <p style="color: #9ca3af; font-size: 14px; text-align: center; padding: 20px 0;">Select a university to view brochures.</p>
        </div>
      </div>
      
      <!-- Analytics Section -->
      <div id="analytics-section" style="margin-top: 26px;">
        <h2 style="margin-bottom: 18px; display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-chart-bar" style="color: #6366f1;"></i>
          Analytics & Insights
        </h2>
        
        <div class="card" style="margin-bottom: 18px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="margin: 0;">Status Distribution</h3>
            <select id="user-status-date-filter" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer;">
              <option value="all">All Time</option>
              <option value="today">Today</option>
              <option value="yesterday">Yesterday</option>
              <option value="week">This Week</option>
              <option value="15days">Last 15 Days</option>
              <option value="30days">Last 30 Days</option>
              <option value="custom">Custom Range</option>
            </select>
          </div>
          <div id="user-status-custom-date-range" style="display: none; margin-bottom: 12px; display: flex; gap: 10px; align-items: center;">
            <input type="date" id="user-status-start-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
            <span style="color: #6b7280;">to</span>
            <input type="date" id="user-status-end-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
            <button onclick="applyUserStatusCustomDateFilter()" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">Apply</button>
          </div>
          <canvas id="user-status-chart" style="max-height: 300px;"></canvas>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr; gap: 18px;">
          <div class="card">
            <h3 style="display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-chart-line" style="color: #047857;"></i>
              Performance Metrics
            </h3>
            <div style="display: flex; flex-direction: column; gap: 14px; margin-top: 14px;">
              <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                <span style="color: #6b7280; font-size: 14px;">Conversion Rate</span>
                <span id="conversion-rate" style="font-weight: 600; color: #047857;">0%</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                <span style="color: #6b7280; font-size: 14px;">Avg. Follow-ups</span>
                <span id="avg-followups" style="font-weight: 600;">0</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                <span style="color: #6b7280; font-size: 14px;">Active Leads</span>
                <span id="active-leads" style="font-weight: 600; color: #0369a1;">0</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!--Lead Detail Modal -->
  <div id="lead-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      
      <h2 id="modal-lead-name"></h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <!-- Left Column: Basic Details -->
        <div class="lead-details" style="border-right: 1px solid #e5e7eb; padding-right: 20px;">
          <p style="margin: 8px 0; font-size: 14px;"><strong>Contact:</strong> <span id="modal-lead-contact"></span></p>
          <p style="margin: 8px 0; font-size: 14px;"><strong>Email:</strong> <span id="modal-lead-email"></span></p>
          <p style="margin: 8px 0; font-size: 14px;"><strong>City:</strong> <span id="modal-lead-city"></span></p>
        </div>
        
        <!-- Right Column: University/Course Details -->
        <div class="lead-details">
          <p style="margin: 8px 0; font-size: 14px;"><strong>University:</strong> <span id="modal-lead-university"></span></p>
          <p style="margin: 8px 0; font-size: 14px;"><strong>Course:</strong> <span id="modal-lead-course"></span></p>
          <p style="margin: 8px 0; font-size: 14px;"><strong>Profession:</strong> <span id="modal-lead-profession"></span></p>
        </div>
      </div>

      <div style="margin-bottom: 20px;">
        <div id="modal-lead-brochure" style="margin-bottom: 12px;"></div>
        <div id="modal-lead-whatsapp"></div>
      </div>

      <div class="form-group">
        <label for="modal-lead-status">Status:</label>
        <select id="modal-lead-status">
          <option value="Fresh">Fresh</option>
          <option value="Buffer fresh">Buffer fresh</option>
          <option value="Did not pick">Did not pick</option>
          <option value="Request call back">Request call back</option>
          <option value="Follow up">Follow up</option>
          <option value="Counselled">Counselled</option>
          <option value="Interested in next batch">Interested in next batch</option>
          <option value="Registration fees paid">Registration fees paid</option>
          <option value="Enrolled">Enrolled</option>
          <option value="Junk/not interested">Junk/not interested</option>
        </select>
        <button onclick="updateLeadStatus()" class="btn btn-primary">Update Status</button>
      </div>
      
      <div class="form-group" style="margin-top: 20px;">
        <label for="modal-followup-datetime" style="display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-phone" style="color: #6366f1;"></i>
          Schedule Next Call:
        </label>
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <input type="datetime-local" id="modal-followup-datetime" style="flex: 1; min-width: 200px;">
          <button onclick="scheduleFollowUp()" class="btn btn-primary" style="white-space: nowrap;">
            <i class="fas fa-calendar-check"></i> Set Reminder
          </button>
          <button onclick="clearFollowUp()" class="btn btn-secondary" style="white-space: nowrap;">
            <i class="fas fa-times"></i> Clear
          </button>
        </div>
        <div id="current-followup-display" style="display: none; margin-top: 10px; padding: 10px; background: #eff6ff; border-radius: 6px; border: 1px solid #bfdbfe;">
          <p style="margin: 0; font-size: 13px; color: #1e40af;">
            <i class="fas fa-bell" style="margin-right: 6px;"></i>
            <strong>Next Call Scheduled:</strong> <span id="followup-display-time"></span>
          </p>
        </div>
      </div>
      
      <h3>Status History</h3>
      <div id="status-history-container" class="notes-list"></div>
      
      <h3>Follow-up Notes</h3>
      
      <div class="form-group">
        <textarea id="new-note" placeholder="Add a follow-up note..." rows="3"></textarea>
        <button onclick="addNote()" class="btn btn-primary">Add Note</button>
      </div>
      
      <div id="notes-container" class="notes-list"></div>
      
    </div>
  </div>
  
  <!-- Notification Panel -->
  <div id="notification-panel" style="display:none; position:fixed; top:70px; right:20px; width:380px; max-height:600px; background:white; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:10000; border:1px solid #e5e7eb; overflow:hidden;">
    <div style="background:linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); padding:16px; color:white; display:flex; justify-content:space-between; align-items:center;">
      <div style="display:flex; align-items:center; gap:10px;">
        <i class="fas fa-bell" style="font-size:18px;"></i>
        <h3 style="margin:0; font-size:16px; font-weight:600;">Follow-up Reminders</h3>
      </div>
      <button onclick="closeNotificationPanel()" style="background:none; border:none; color:white; font-size:20px; cursor:pointer; padding:0; width:24px; height:24px;">&times;</button>
    </div>
    <div id="notification-list" style="max-height:500px; overflow-y:auto;">
      <p style="text-align:center; color:#9ca3af; padding:30px 20px; margin:0;">No pending reminders</p>
    </div>
  </div>
  
  <!-- Single Reminder Popup (for immediate alert) -->
  <div id="reminder-popup" style="display:none; position:fixed; top:20px; right:20px; width:350px; background:white; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:20000; border:2px solid #6366f1; animation: slideInRight 0.3s ease;">
    <div style="background:linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); padding:16px; border-radius:10px 10px 0 0; color:white; display:flex; justify-content:space-between; align-items:center;">
      <div style="display:flex; align-items:center; gap:10px;">
        <i class="fas fa-bell" style="font-size:20px; animation: ring 1s ease-in-out infinite;"></i>
        <h3 style="margin:0; font-size:16px; font-weight:600;">Follow-up Reminder!</h3>
      </div>
      <button onclick="closeReminderPopup()" style="background:none; border:none; color:white; font-size:20px; cursor:pointer; padding:0; width:24px; height:24px;">&times;</button>
    </div>
    <div style="padding:20px;">
      <p style="margin:0 0 12px; color:#374151; font-size:14px; font-weight:500;" id="reminder-message">Time to follow up with this lead:</p>
      <div style="background:#f9fafb; padding:12px; border-radius:8px; border:1px solid #e5e7eb; margin-bottom:16px;">
        <p style="margin:0 0 6px; font-size:15px; font-weight:600; color:#111827;" id="reminder-lead-name"></p>
        <p style="margin:0 0 4px; font-size:13px; color:#6b7280;"><i class="fas fa-phone" style="margin-right:6px;"></i><span id="reminder-lead-contact"></span></p>
        <p style="margin:0; font-size:13px; color:#6b7280;"><i class="fas fa-envelope" style="margin-right:6px;"></i><span id="reminder-lead-email"></span></p>
      </div>
      <div style="display:flex; gap:10px;">
        <button onclick="openLeadFromReminder()" class="btn btn-primary" style="flex:1; font-size:14px;">
          <i class="fas fa-external-link-alt"></i> Open Lead
        </button>
        <button onclick="snoozeReminder()" class="btn btn-secondary" style="font-size:14px;">
          <i class="fas fa-clock"></i> Snooze 15min
        </button>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer style="position:fixed; bottom:0; left:260px; right:0; padding:10px 20px; background:rgba(249,250,251,0.95); border-top:1px solid #e5e7eb; font-size:11px; color:#6b7280; text-align:center; z-index:100; backdrop-filter: blur(8px);">
    <span>Â© 2025 DegreeDrishti. All rights reserved.</span>
    <span style="margin-left:16px; color:#9ca3af;">Developed by Samarth</span>
  </footer>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="js/config.js?v=1.1"></script>
  <script src="js/user.js?v=1.1"></script>
</body>
</html>
