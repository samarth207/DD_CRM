<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="theme-color" content="#6366f1">
  <meta name="description" content="DD CRM Admin Dashboard - Comprehensive lead management and analytics">
  <title>DD CRM - Admin Dashboard</title>
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <link rel="apple-touch-icon" href="assets/favicon.png">
  
  <!-- DNS Prefetch & Preconnect for faster external resource loading -->
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  
  <!-- Optimized resource loading -->
  <link rel="preload" href="css/style.css?v=3.0" as="style">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" as="script" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css?v=3.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer crossorigin></script>
</head>
<body>
  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="sidebar-logo">
      <img src="assets/logo.png" alt="DegreeDrishti CRM">
    </div>
    
    <div class="sidebar-nav">
      <a href="#" class="sidebar-nav-item active" data-section="dashboard">
        <i class="fas fa-chart-line"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="all-leads">
        <i class="fas fa-database"></i>
        <span>All Leads Management</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="performance">
        <i class="fas fa-bolt"></i>
        <span>Performance</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="upload">
        <i class="fas fa-upload"></i>
        <span>Upload Leads</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="brochures">
        <i class="fas fa-file-pdf"></i>
        <span>Brochures</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="progress">
        <i class="fas fa-chart-bar"></i>
        <span>User Progress</span>
      </a>
      <a href="#" class="sidebar-nav-item" data-section="settings">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
    </div>
    
    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="sidebar-user-avatar">A</div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name" id="admin-name-sidebar">Admin</div>
          <div class="sidebar-user-role">Administrator</div>
        </div>
      </div>
      <button onclick="logout()" class="btn btn-secondary" style="width: 100%;">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>
  
  <!-- Top Header -->
  <div class="top-header">
    <div class="header-title">Admin Dashboard</div>
    <div class="header-actions">
      <span id="admin-name" style="color: #6b7280; font-size: 13px; font-weight: 500;"></span>
    </div>
  </div>
  
  <!-- Update Notification Banner (for admin) -->
  <div id="admin-update-notification-banner" style="display: none; position: fixed; top: 70px; left: 250px; right: 0; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 14px 20px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-bottom: 2px solid #b45309;">
    <div style="display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto;">
      <div style="display: flex; align-items: center; gap: 12px;">
        <i class="fas fa-exclamation-circle" style="font-size: 20px;"></i>
        <div>
          <strong style="font-size: 15px;">Updates Available</strong>
          <p id="admin-update-notification-message" style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.95;">Leads have been updated by users.</p>
        </div>
      </div>
      <div style="display: flex; gap: 10px;">
        <button onclick="refreshAdminData()" class="btn" style="background: white; color: #d97706; border: none; padding: 8px 16px; font-weight: 600; font-size: 13px;">
          <i class="fas fa-sync-alt"></i> Refresh Now
        </button>
        <button onclick="dismissAdminUpdateNotification()" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 12px; font-size: 13px;">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>
  
  <div class="container with-header">
    <div class="dashboard">
      
      <!-- Overall Dashboard Section -->
      <div class="card">
        <h2 class="collapsible-header" onclick="toggleOverallDashboard()">
          <span><i class="fas fa-chart-line" style="margin-right: 8px; color: #6366f1;"></i>Overall Dashboard</span>
          <span id="overall-dashboard-toggle" class="collapse-icon">−</span>
        </h2>
        <div id="overall-dashboard-body">
        
        <div id="overall-stats-container">
        <div id="overall-stats">
          <div class="stats-grid" style="gap: 24px; margin-bottom: 24px;">
            <div class="stat-card" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border: none; box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4); transform: translateY(0); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 35px -5px rgba(99, 102, 241, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px -5px rgba(99, 102, 241, 0.4)';">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <h4 style="margin: 0; font-size: 15px; font-weight: 600; color: rgba(255,255,255,0.95);">Total Users</h4>
                <div style="background: rgba(255,255,255,0.25); padding: 10px; border-radius: 12px;">
                  <i class="fas fa-users" style="font-size: 24px; color: white;"></i>
                </div>
              </div>
              <p id="overall-total-users" class="stat-number" style="font-size: 42px; font-weight: 800; margin: 8px 0 0 0; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">0</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%); color: white; border: none; box-shadow: 0 10px 25px -5px rgba(236, 72, 153, 0.4); transform: translateY(0); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 35px -5px rgba(236, 72, 153, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px -5px rgba(236, 72, 153, 0.4)';">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <h4 style="margin: 0; font-size: 15px; font-weight: 600; color: rgba(255,255,255,0.95);">Total Leads</h4>
                <div style="background: rgba(255,255,255,0.25); padding: 10px; border-radius: 12px;">
                  <i class="fas fa-database" style="font-size: 24px; color: white;"></i>
                </div>
              </div>
              <p id="overall-total-leads" class="stat-number" style="font-size: 42px; font-weight: 800; margin: 8px 0 0 0; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">0</p>
            </div>
          </div>
          
          <div style="background: white; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb; margin: 14px 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 style="margin: 0; color: #6366f1; font-size: 14px;">Overall Status Distribution</h3>
              <select id="overall-chart-date-filter" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer;">
                <option value="all">All Time</option>
                <option value="today">Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="week">This Week</option>
                <option value="15days">Last 15 Days</option>
                <option value="30days">Last 30 Days</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
            <div id="overall-custom-date-range" style="display: none; margin-bottom: 12px; gap: 10px; align-items: center;">
              <input type="date" id="overall-start-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
              <span style="color: #6b7280;">to</span>
              <input type="date" id="overall-end-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
              <button onclick="applyOverallCustomDateFilter()" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">Apply</button>
            </div>
            <canvas id="overallStatusChart" style="max-height: 300px;"></canvas>
          </div>
          
          <div style="background: white; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb; margin: 14px 0;">
            <h3 style="text-align: center; color: #6366f1; margin-bottom: 14px; font-size: 14px;">Leads by User</h3>
            <canvas id="userLeadsChart" style="max-height: 300px;"></canvas>
          </div>
        </div>
        </div>
      </div>

      <!-- Overall Performance Section -->
      <div class="card" id="overall-performance-card">
        <h2><i class="fas fa-bolt" style="margin-right: 8px; color: #6366f1;"></i>Performance</h2>
        <div id="overall-performance-body">
          <div style="background: white; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb;">
            <h3 style="text-align: center; color: #047857; margin-bottom: 18px; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <i class="fas fa-chart-line"></i>
              Performance Metrics
            </h3>
            <div style="display: flex; flex-direction: column; gap: 14px;">
              <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f3f4f6; background: #f9fafb; border-radius: 4px;">
                <span style="color: #6b7280; font-size: 14px; font-weight: 500;">Total Conversion Rate</span>
                <span id="overall-conversion-rate" style="font-weight: 700; color: #047857; font-size: 16px;">0%</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f3f4f6; background: #f9fafb; border-radius: 4px;">
                <span style="color: #6b7280; font-size: 14px; font-weight: 500;">Avg. Follow-ups per Lead</span>
                <span id="overall-avg-followups" style="font-weight: 700; color: #6366f1; font-size: 16px;">0</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 12px; background: #f9fafb; border-radius: 4px;">
                <span style="color: #6b7280; font-size: 14px; font-weight: 500;">Total Active Leads</span>
                <span id="overall-active-leads" style="font-weight: 700; color: #0369a1; font-size: 16px;">0</span>
              </div>
            </div>
          </div>
          <p style="margin-top:14px; font-size:12px; color:#6b7280;">Metrics are automatically loaded when you open the dashboard.</p>
        </div>
      </div>

      <!-- All Leads Section -->
      <div class="card" id="all-leads-card">
        <h2 style="display:flex; justify-content:space-between; align-items:center;">
          <div style="display: flex; align-items: center; gap: 16px;">
            <span><i class="fas fa-database" style="margin-right: 8px; color: #6366f1;"></i>All Leads Management</span>
            <span style="padding: 6px 12px; background: #f3f4f6; border-radius: 6px; font-size: 13px; color: #6b7280; font-weight: 500;">
              Total: <strong id="all-leads-total-header" style="color: #1f2937;">0</strong>
            </span>
          </div>
          <button onclick="openCreateLeadModal()" class="btn btn-primary" style="font-size: 13px;">
            <i class="fas fa-plus"></i> Add Lead
          </button>
        </h2>
        
        <!-- Filter and Search Controls -->
        <div style="margin: 18px 0; display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-start;">
          <input type="text" id="all-leads-search" placeholder="Search by name, email, contact, city..." style="flex: 1; min-width: 250px; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px;">
          
          <!-- Multi-select Status Filter -->
          <div class="multi-select" id="status-multiselect" style="min-width: 150px;">
            <div class="multi-select-toggle" id="status-multiselect-toggle" style="padding: 8px 12px; font-size: 13px;">All Statuses</div>
            <div class="multi-select-dropdown" id="status-multiselect-dropdown" style="display:none; min-width: 220px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <button type="button" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;" onclick="selectAllStatuses()">Select All</button>
                <button type="button" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;" onclick="clearStatusFilter()">Clear</button>
              </div>
              <label class="multi-select-item"><input type="checkbox" value="Fresh" onchange="updateStatusFilter()"> Fresh</label>
              <label class="multi-select-item"><input type="checkbox" value="Buffer fresh" onchange="updateStatusFilter()"> Buffer fresh</label>
              <label class="multi-select-item"><input type="checkbox" value="Did not pick" onchange="updateStatusFilter()"> Did not pick</label>
              <label class="multi-select-item"><input type="checkbox" value="Request call back" onchange="updateStatusFilter()"> Request call back</label>
              <label class="multi-select-item"><input type="checkbox" value="Follow up" onchange="updateStatusFilter()"> Follow up</label>
              <label class="multi-select-item"><input type="checkbox" value="Counselled" onchange="updateStatusFilter()"> Counselled</label>
              <label class="multi-select-item"><input type="checkbox" value="Interested in next batch" onchange="updateStatusFilter()"> Interested in next batch</label>
              <label class="multi-select-item"><input type="checkbox" value="Registration fees paid" onchange="updateStatusFilter()"> Registration fees paid</label>
              <label class="multi-select-item"><input type="checkbox" value="Enrolled" onchange="updateStatusFilter()"> Enrolled</label>
              <label class="multi-select-item"><input type="checkbox" value="Junk/not interested" onchange="updateStatusFilter()"> Junk/not interested</label>
            </div>
          </div>
          
          <!-- Multi-select User Filter -->
          <div class="multi-select" id="user-filter-multiselect" style="min-width: 140px;">
            <div class="multi-select-toggle" id="user-filter-toggle" style="padding: 8px 12px; font-size: 13px;">All Users</div>
            <div class="multi-select-dropdown" id="user-filter-dropdown" style="display:none; min-width: 250px;"></div>
          </div>
          
          <!-- Multi-select Source Filter -->
          <div class="multi-select" id="source-multiselect" style="min-width: 140px;">
            <div class="multi-select-toggle" id="source-multiselect-toggle" style="padding: 8px 12px; font-size: 13px;">All Sources</div>
            <div class="multi-select-dropdown" id="source-multiselect-dropdown" style="display:none; min-width: 200px;"></div>
          </div>
          
          <!-- Multi-select University Filter -->
          <div class="multi-select" id="university-multiselect" style="min-width: 140px;">
            <div class="multi-select-toggle" id="university-multiselect-toggle" style="padding: 8px 12px; font-size: 13px;">All Universities</div>
            <div class="multi-select-dropdown" id="university-multiselect-dropdown" style="display:none; min-width: 250px;"></div>
          </div>
          
          <!-- Hidden inputs for backward compatibility -->
          <input type="hidden" id="all-leads-status-filter" value="">
          <input type="hidden" id="all-leads-user-filter" value="">
          <input type="hidden" id="all-leads-source-filter" value="">
          
          <button onclick="toggleTransitionFilter()" class="btn btn-secondary" style="font-size: 13px;">
            <i class="fas fa-exchange-alt"></i> Status Transition
          </button>
          
          <button onclick="toggleNoActionFilter()" class="btn btn-secondary" style="font-size: 13px;">
            <i class="fas fa-user-clock"></i> No Action Taken
          </button>
          
          <button onclick="toggleTransferFilter()" class="btn btn-secondary" style="font-size: 13px;">
            <i class="fas fa-user-friends"></i> Lead Transfer
          </button>
          
          <button onclick="clearAllFilters()" class="btn btn-secondary" style="font-size: 13px;">
            <i class="fas fa-filter-circle-xmark"></i> Clear Filters
          </button>
          
          <button onclick="loadAllLeads()" class="btn btn-secondary" style="font-size: 13px;">
            <i class="fas fa-sync"></i> Refresh
          </button>
          
          <button onclick="showFilteredLeadsGraph()" class="btn btn-primary" style="font-size: 13px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);">
            <i class="fas fa-chart-bar"></i> Show Graph
          </button>
        </div>

        <!-- No Action Filter Panel -->
        <div id="no-action-filter-panel" style="display: none; margin-bottom: 16px; padding: 16px; background: #fef3c7; border: 1px solid #fde68a; border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h4 style="margin: 0; color: #92400e; font-size: 14px; font-weight: 600;">
              <i class="fas fa-exclamation-triangle"></i> Filter Leads with No Action Taken
            </h4>
            <button onclick="clearNoActionFilter()" class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;">
              <i class="fas fa-times"></i> Clear
            </button>
          </div>
          
          <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-size: 13px; color: #78350f; font-weight: 500;">Show leads with no activity for:</label>
              <select id="no-action-period" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; min-width: 150px;">
                <option value="1">Last 24 Hours</option>
                <option value="3">Last 3 Days</option>
                <option value="7">Last 7 Days</option>
                <option value="15">Last 15 Days</option>
                <option value="30">Last 30 Days</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
            
            <div id="no-action-custom-dates" style="display: none; gap: 8px; align-items: center;">
              <input type="date" id="no-action-start-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
              <span style="color: #6b7280;">to</span>
              <input type="date" id="no-action-end-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
            </div>
            
            <button onclick="applyNoActionFilter()" class="btn btn-primary" style="font-size: 13px; padding: 6px 14px;">
              <i class="fas fa-check"></i> Apply Filter
            </button>
          </div>
          
          <div id="no-action-filter-status" style="margin-top: 10px; font-size: 12px; color: #78350f;">
            <i class="fas fa-info-circle"></i> This will show leads assigned but not updated (no status changes or notes added) during the selected period.
          </div>
        </div>

        <!-- Lead Transfer Filter Panel -->
        <div id="transfer-filter-panel" style="display: none; margin-bottom: 16px; padding: 16px; background: #eff6ff; border: 1px solid #93c5fd; border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h4 style="margin: 0; color: #1e40af; font-size: 14px; font-weight: 600;">
              <i class="fas fa-user-friends"></i> Filter by Lead Transfer
            </h4>
            <button onclick="clearTransferFilter()" class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;">
              <i class="fas fa-times"></i> Clear
            </button>
          </div>
          
          <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-size: 13px; color: #1e3a8a; font-weight: 500;">From User:</label>
              <select id="transfer-from-user" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; min-width: 150px;">
                <option value="">Any User</option>
              </select>
            </div>
            
            <i class="fas fa-arrow-right" style="color: #1e40af;"></i>
            
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-size: 13px; color: #1e3a8a; font-weight: 500;">To User:</label>
              <select id="transfer-to-user" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; min-width: 150px;">
                <option value="">Any User</option>
              </select>
            </div>
            
            <div style="border-left: 2px solid #93c5fd; padding-left: 12px; margin-left: 8px; display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 13px; color: #1e3a8a; font-weight: 500;">Time Period:</label>
              <select id="transfer-date-filter" onchange="handleTransferDateFilter()" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white;">
                <option value="all">All Time</option>
                <option value="today">Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="week">This Week</option>
                <option value="15days">Last 15 Days</option>
                <option value="30days">Last 30 Days</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
            
            <div id="transfer-custom-dates" style="display: none; gap: 8px; align-items: center;">
              <input type="date" id="transfer-start-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
              <span style="color: #6b7280;">to</span>
              <input type="date" id="transfer-end-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
            </div>
            
            <button onclick="applyTransferFilter()" class="btn btn-primary" style="font-size: 13px; padding: 6px 14px;">
              <i class="fas fa-check"></i> Apply Filter
            </button>
          </div>
          
          <div id="transfer-filter-status" style="margin-top: 10px; font-size: 12px; color: #1e3a8a;">
            <i class="fas fa-info-circle"></i> Select transfer criteria and time period, then click Apply.
          </div>
        </div>

        <!-- Status Transition Filter Panel -->
        <div id="transition-filter-panel" style="display: none; margin-bottom: 16px; padding: 16px; background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h4 style="margin: 0; color: #047857; font-size: 14px; font-weight: 600;">
              <i class="fas fa-filter"></i> Filter by Status Transition
            </h4>
            <button onclick="clearTransitionFilter()" class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;">
              <i class="fas fa-times"></i> Clear
            </button>
          </div>
          
          <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-size: 13px; color: #065f46; font-weight: 500;">From:</label>
              <select id="transition-from-status" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; min-width: 150px;">
                <option value="">Any Status</option>
                <option value="Fresh">Fresh</option>
                <option value="Buffer fresh">Buffer fresh</option>
                <option value="Did not pick">Did not pick</option>
                <option value="Request call back">Request call back</option>
                <option value="Follow up">Follow up</option>
                <option value="Counselled">Counselled</option>
                <option value="Interested in next batch">Interested in next batch</option>
                <option value="Registration fees paid">Registration fees paid</option>
                <option value="Enrolled">Enrolled</option>
                <option value="Junk/not interested">Junk/not interested</option>
              </select>
            </div>
            
            <i class="fas fa-arrow-right" style="color: #047857;"></i>
            
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-size: 13px; color: #065f46; font-weight: 500;">To:</label>
              <select id="transition-to-status" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; min-width: 150px;">
                <option value="">Any Status</option>
                <option value="Fresh">Fresh</option>
                <option value="Buffer fresh">Buffer fresh</option>
                <option value="Did not pick">Did not pick</option>
                <option value="Request call back">Request call back</option>
                <option value="Follow up">Follow up</option>
                <option value="Counselled">Counselled</option>
                <option value="Interested in next batch">Interested in next batch</option>
                <option value="Registration fees paid">Registration fees paid</option>
                <option value="Enrolled">Enrolled</option>
                <option value="Junk/not interested">Junk/not interested</option>
              </select>
            </div>
            
            <div style="border-left: 2px solid #86efac; padding-left: 12px; margin-left: 8px; display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 13px; color: #065f46; font-weight: 500;">Time Period:</label>
              <select id="transition-date-filter" onchange="handleTransitionDateFilter()" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white;">
                <option value="all">All Time</option>
                <option value="today">Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="week">This Week</option>
                <option value="15days">Last 15 Days</option>
                <option value="30days">Last 30 Days</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
            
            <div id="transition-custom-dates" style="display: none; gap: 8px; align-items: center;">
              <input type="date" id="transition-start-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
              <span style="color: #6b7280;">to</span>
              <input type="date" id="transition-end-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
            </div>
            
            <button onclick="applyTransitionFilter()" class="btn btn-primary" style="font-size: 13px; padding: 6px 14px;">
              <i class="fas fa-check"></i> Apply Filter
            </button>
          </div>
          
          <div id="transition-filter-status" style="margin-top: 10px; font-size: 12px; color: #065f46;">
            <i class="fas fa-info-circle"></i> Select status transition and time period, then click Apply.
          </div>
          
          <!-- Quick Preset Buttons -->
          <div style="margin-top: 14px; padding-top: 12px; border-top: 1px solid #86efac;">
            <div style="font-size: 12px; color: #065f46; font-weight: 600; margin-bottom: 8px;">
              <i class="fas fa-magic"></i> Quick Presets:
            </div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button onclick="applyQuickTransition('Fresh', 'Follow up')" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                Fresh → Follow up
              </button>
              <button onclick="applyQuickTransition('Fresh', 'Buffer fresh')" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                Fresh → Buffer fresh
              </button>
              <button onclick="applyQuickTransition('Did not pick', 'Junk/not interested')" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                Did not pick → Junk
              </button>
              <button onclick="applyQuickTransition('Follow up', 'Counselled')" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                Follow up → Counselled
              </button>
              <button onclick="applyQuickTransition('Counselled', 'Enrolled')" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">
                Counselled → Enrolled
              </button>
            </div>
          </div>
        </div>

        <!-- Bulk Actions -->
        <div id="bulk-actions-bar" style="display: none; margin-bottom: 16px; padding: 12px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px;">
          <div style="margin-bottom: 8px; padding: 6px 10px; background: #dbeafe; border-radius: 4px; font-size: 11px; color: #1e40af;">
            <i class="fas fa-info-circle"></i> <strong>Tip:</strong> You can perform combined operations! Select leads, update status AND transfer to another user in one action.
          </div>
          <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            <span style="font-weight: 600; color: #0369a1;">
              <span id="selected-count">0</span> lead(s) selected
            </span>
            
            <button onclick="clearSelection()" class="btn" style="font-size: 11px; padding: 4px 10px; background: #f3f4f6; color: #6b7280; border: 1px solid #d1d5db;">
              <i class="fas fa-times-circle"></i> Clear Selection
            </button>
            
            <div style="display: flex; align-items: center; gap: 6px;">
              <label style="font-size: 12px; color: #6b7280; white-space: nowrap;">Select first:</label>
              <input type="number" id="limit-selection-count" min="1" placeholder="e.g., 30" style="width: 80px; padding: 6px 8px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;" oninput="resetSelectButtonState()">
              <button onclick="selectLimitedLeads()" class="btn btn-secondary" style="font-size: 12px; padding: 6px 10px;">
                <i class="fas fa-check-square"></i> Select
              </button>
            </div>
            
            <select id="bulk-status-select" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; background: white;">
              <option value="">Change Status...</option>
              <option value="Fresh">Fresh</option>
              <option value="Buffer fresh">Buffer fresh</option>
              <option value="Did not pick">Did not pick</option>
              <option value="Request call back">Request call back</option>
              <option value="Follow up">Follow up</option>
              <option value="Counselled">Counselled</option>
              <option value="Interested in next batch">Interested in next batch</option>
              <option value="Registration fees paid">Registration fees paid</option>
              <option value="Enrolled">Enrolled</option>
              <option value="Junk/not interested">Junk/not interested</option>
            </select>
            
            <!-- Multi-select Transfer Users -->
            <div class="multi-select" id="bulk-transfer-multiselect" style="min-width: 180px;">
              <div class="multi-select-toggle" id="bulk-transfer-toggle" style="padding: 6px 10px; font-size: 12px;">Transfer To...</div>
              <div class="multi-select-dropdown" id="bulk-transfer-dropdown" style="display:none; min-width: 250px;"></div>
            </div>
            <input type="hidden" id="bulk-transfer-select" value="">
            
            <button onclick="performBulkActions()" class="btn btn-primary" style="font-size: 12px; padding: 6px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
              <i class="fas fa-bolt"></i> Apply Actions
            </button>
            
            <button onclick="bulkDeleteLeads()" class="btn btn-danger" style="font-size: 12px; padding: 6px 12px; background: #dc2626;">
              <i class="fas fa-trash"></i> Delete
            </button>
            
            <button onclick="clearSelection()" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;">
              <i class="fas fa-times"></i> Clear
            </button>
          </div>
        </div>

        <!-- Leads Table -->
        <div style="margin-top: 18px;">
          <table class="data-table" id="all-leads-table" style="table-layout: auto; width: 100%;">
            <thead>
              <tr>
                <th style="width: 40px;">
                  <input type="checkbox" id="select-all-leads" onchange="toggleSelectAll()" style="cursor: pointer;">
                </th>
                <th style="width: 16%;">Name</th>
                <th style="width: 11%;">Contact</th>
                <th style="width: 10%;">City</th>
                <th style="width: 13%;">University</th>
                <th style="width: 10%;">Source</th>
                <th style="width: 11%;">Status</th>
                <th style="width: 11%;">Assigned To</th>
                <th style="width: 9%;">Updated</th>
              </tr>
            </thead>
            <tbody id="all-leads-tbody">
              <tr>
                <td colspan="9" style="text-align: center; padding: 40px; color: #9ca3af;">
                  Click "Refresh" to load all leads...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination Controls -->
        <div style="margin-top: 18px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
          <div style="padding: 12px; background: #f9fafb; border-radius: 6px; font-size: 13px; color: #6b7280;">
            Total Leads: <strong id="all-leads-total">0</strong> | 
            Showing: <strong id="all-leads-showing">0</strong>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 13px; color: #6b7280;">Per page:</span>
            <select id="leads-per-page" onchange="changeLeadsPerPage()" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer;">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          <div id="pagination-controls" style="display: flex; gap: 6px; align-items: center;">
            <button onclick="goToFirstPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="first-page-btn">
              <i class="fas fa-angle-double-left"></i>
            </button>
            <button onclick="goToPrevPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="prev-page-btn">
              <i class="fas fa-angle-left"></i>
            </button>
            <span style="padding: 6px 12px; font-size: 13px; color: #6b7280;">
              Page <strong id="current-page">1</strong> of <strong id="total-pages">1</strong>
            </span>
            <button onclick="goToNextPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="next-page-btn">
              <i class="fas fa-angle-right"></i>
            </button>
            <button onclick="goToLastPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="last-page-btn">
              <i class="fas fa-angle-double-right"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Upload Leads Section -->
      <div class="card" id="upload-leads-card">
        <h2><i class="fas fa-upload" style="margin-right: 8px; color: #6366f1;"></i>Upload Leads</h2>
        <form id="upload-form" enctype="multipart/form-data">
          <div class="form-group">
            <label>Assign to Users</label>
            <div class="multi-select" id="user-multiselect">
              <div class="multi-select-toggle" id="user-multiselect-toggle">Select users...</div>
              <div class="multi-select-dropdown" id="user-multiselect-dropdown" style="display:none;"></div>
            </div>
            <small style="color: #9ca3af; display: block; margin-top: 4px; font-size: 12px;">Select one or more users. Leads will be distributed equally.</small>
          </div>
          <div class="form-group">
            <label for="file-upload">Excel File</label>
            <input type="file" id="file-upload" name="file" accept=".xlsx,.xls" required>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-upload"></i> Upload Leads
          </button>
        </form>
        <div id="upload-message" class="message" style="display: none;"></div>
        <div id="upload-distribution" class="info-box" style="display:none; margin-top:14px;"></div>
        <div class="info-box">
          <h4>Required Excel Columns:</h4>
          <p style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">Use the exact column headers below (case-insensitive):</p>
          <ul style="columns:2; gap:12px;">
            <li>Name</li>
            <li>Contact</li>
            <li>Email</li>
            <li>City</li>
            <li>University</li>
            <li>Course</li>
            <li>Profession</li>
            <li>Status (optional)</li>
            <li>Notes (optional)</li>
          </ul>
          <p style="font-size:11px; color:#9ca3af; margin-top:8px;">Extra columns are ignored. Status defaults to "Fresh" if omitted.</p>
        </div>
      </div>

      <!-- User Progress Section -->
      <div class="card" id="user-progress-card">
        <h2 class="collapsible-header" onclick="toggleUserProgress()">
          <span><i class="fas fa-chart-bar" style="margin-right: 8px; color: #6366f1;"></i>User Progress</span>
          <span id="user-progress-toggle" class="collapse-icon">-</span>
        </h2>
        <div id="user-progress-body" style="display:block;">
        <div class="form-group">
          <label for="progress-user-select">Select User</label>
          <select id="progress-user-select">
            <option value="">Select a user...</option>
          </select>
        </div>
        
        <div id="user-progress" style="display: none;">
          <h3 id="progress-user-name" style="color: #111827; font-size: 15px; margin-bottom: 18px;"></h3>
          
          <!-- Status Chart -->
          <div style="background: white; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 18px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 style="margin: 0; color: #6366f1; font-size: 14px;">Lead Status Distribution</h3>
              <select id="user-chart-date-filter" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer;">
                <option value="all">All Time</option>
                <option value="today">Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="week">This Week</option>
                <option value="15days">Last 15 Days</option>
                <option value="30days">Last 30 Days</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
            <div id="user-custom-date-range" style="display: none; margin-bottom: 12px; gap: 10px; align-items: center;">
              <input type="date" id="user-start-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
              <span style="color: #6b7280;">to</span>
              <input type="date" id="user-end-date" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px;">
              <button onclick="applyUserCustomDateFilter()" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">Apply</button>
            </div>
            <canvas id="statusChart" style="max-height: 300px;"></canvas>
          </div>
          
          <!-- User Performance Metrics -->
          <div style="background: white; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 18px;">
            <h3 style="text-align: center; color: #047857; margin-bottom: 18px; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <i class="fas fa-chart-line"></i>
              Performance Metrics
            </h3>
            <div style="display: flex; flex-direction: column; gap: 14px;">
              <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f3f4f6; background: #f9fafb; border-radius: 4px;">
                <span style="color: #6b7280; font-size: 14px; font-weight: 500;">Conversion Rate</span>
                <span id="user-conversion-rate" style="font-weight: 700; color: #047857; font-size: 16px;">0%</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f3f4f6; background: #f9fafb; border-radius: 4px;">
                <span style="color: #6b7280; font-size: 14px; font-weight: 500;">Avg. Follow-ups per Lead</span>
                <span id="user-avg-followups" style="font-weight: 700; color: #6366f1; font-size: 16px;">0</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 12px; background: #f9fafb; border-radius: 4px;">
                <span style="color: #6b7280; font-size: 14px; font-weight: 500;">Active Leads</span>
                <span id="user-active-leads" style="font-weight: 700; color: #0369a1; font-size: 16px;">0</span>
              </div>
            </div>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card">
              <h4>Total Leads</h4>
              <p id="total-leads" class="stat-number">0</p>
            </div>
          </div>
          
          <h3>Recent Leads</h3>
          
          <!-- Filter Controls -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <input type="text" id="user-lead-search" placeholder="Search by name, contact, email..." autocomplete="off" style="flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px;">
            
            <select id="user-status-filter" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer; min-width: 180px;">
              <option value="">All Statuses</option>
              <option value="Fresh">Fresh</option>
              <option value="Buffer fresh">Buffer fresh</option>
              <option value="Did not pick">Did not pick</option>
              <option value="Request call back">Request call back</option>
              <option value="Follow up">Follow up</option>
              <option value="Counselled">Counselled</option>
              <option value="Interested in next batch">Interested in next batch</option>
              <option value="Registration fees paid">Registration fees paid</option>
              <option value="Enrolled">Enrolled</option>
              <option value="Junk/not interested">Junk/not interested</option>
            </select>
            
            <button onclick="clearUserLeadsFilter()" class="btn btn-secondary" style="font-size: 13px; padding: 6px 12px;">
              <i class="fas fa-times"></i> Clear Filters
            </button>
          </div>
          
          <div id="leads-table-container" style="overflow-x: auto; max-width: 100%;">
            <table id="leads-table" class="data-table" style="table-layout: auto; min-width: 800px; width: 100%;">
              <thead>
                <tr>
                  <th style="width: 14%;">Name</th>
                  <th style="width: 10%;">Contact</th>
                  <th style="width: 14%;">Email</th>
                  <th style="width: 9%;">City</th>
                  <th style="width: 12%;">University</th>
                  <th style="width: 10%;">Course</th>
                  <th style="width: 9%;">Profession</th>
                  <th style="width: 8%;">Source</th>
                  <th style="width: 11%;">Status</th>
                  <th style="width: 9%;">Last Updated</th>
                </tr>
              </thead>
            <tbody id="leads-tbody"></tbody>
          </table>
        </div>
        
        <!-- Pagination Controls -->
        <div style="margin-top: 18px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
          <div style="padding: 12px; background: #f9fafb; border-radius: 6px; font-size: 13px; color: #6b7280;">
            Total: <strong id="user-leads-total">0</strong> | 
            Showing: <strong id="user-leads-showing">0</strong>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 13px; color: #6b7280;">Per page:</span>
            <select id="user-leads-per-page" onchange="changeUserLeadsPerPage()" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; background: white; cursor: pointer;">
              <option value="10">10</option>
              <option value="25" selected>25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          <div id="user-pagination-controls" style="display: flex; gap: 6px; align-items: center;">
            <button onclick="goToUserFirstPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="user-first-page-btn">
              <i class="fas fa-angle-double-left"></i>
            </button>
            <button onclick="goToUserPrevPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="user-prev-page-btn">
              <i class="fas fa-angle-left"></i>
            </button>
            <span style="font-size: 13px; color: #6b7280; padding: 0 8px;">
              Page <strong id="user-current-page">1</strong> of <strong id="user-total-pages">1</strong>
            </span>
            <button onclick="goToUserNextPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="user-next-page-btn">
              <i class="fas fa-angle-right"></i>
            </button>
            <button onclick="goToUserLastPage()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" id="user-last-page-btn">
              <i class="fas fa-angle-double-right"></i>
            </button>
          </div>
        </div>
      </div>
        </div>
      </div>

      <!-- Manage Brochures Section -->
      <div class="card" id="manage-brochures-card">
        <h2 style="display:flex; justify-content:space-between; align-items:center;">
          <span><i class="fas fa-file-pdf" style="margin-right: 8px; color: #e11d48;"></i>Brochures</span>
          <button onclick="openAddBrochureModal()" class="btn btn-primary" style="font-size: 13px;">
            <i class="fas fa-plus"></i> Add Brochure
          </button>
        </h2>
        <div style="margin-top: 18px;">
          <button onclick="loadBrochuresAdmin()" class="btn btn-secondary" style="font-size: 13px; margin-bottom: 14px;">
            <i class="fas fa-sync"></i> Refresh
          </button>
          <div id="brochures-admin-list">
            <p style="color: #9ca3af; text-align: center; padding: 20px 0;">Click refresh to load brochures...</p>
          </div>
        </div>
      </div>
      
      <!-- Settings Section -->
      <div class="card" id="settings-card">
        <h2><i class="fas fa-cog" style="margin-right: 8px; color: #6366f1;"></i>Settings</h2>
        
        <!-- Manage Users Subsection -->
        <div style="margin-top: 22px;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:18px;">
            <h3 style="margin:0; font-size:16px; color:#111827;"><i class="fas fa-users" style="margin-right:8px;"></i>Manage Users</h3>
            <button onclick="openCreateUserModal()" class="btn btn-primary" style="font-size: 13px;">
              <i class="fas fa-user-plus"></i> Create User
            </button>
          </div>
          <p style="margin-bottom:12px; color:#6b7280; font-size:13px;">View user details, lead counts, reset passwords, and remove users without assigned leads.</p>
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Leads</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="users-tbody"></tbody>
          </table>
          <div id="users-message" class="message" style="display:none; margin-top:12px;"></div>
        </div>

        <!-- Admin Password Reset Subsection -->
        <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
          <h3 style="margin:0 0 12px 0; font-size:16px; color:#111827;"><i class="fas fa-key" style="margin-right:8px;"></i>Reset Admin Password</h3>
          <p style="margin-bottom:12px; color:#6b7280; font-size:13px;">Change your admin account password.</p>
          <form id="admin-password-form">
            <div class="form-group">
              <label for="admin-new-password">New Password</label>
              <input type="password" id="admin-new-password" placeholder="Minimum 8 characters" required>
            </div>
            
            <div class="form-group">
              <label for="admin-confirm-password">Confirm Password</label>
              <input type="password" id="admin-confirm-password" placeholder="Re-enter password" required>
            </div>
            
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-key"></i> Reset My Password
            </button>
          </form>
          
          <div id="admin-password-message" class="message" style="display: none;"></div>
        </div>
      </div>
      
    </div>
  </div>  <!-- Lead Detail Modal -->
  <div id="admin-lead-modal" class="modal" style="display:none; z-index: 10002; background: transparent; backdrop-filter: none; justify-content: flex-end; padding: 0; align-items: stretch;">
    <div class="modal-content" style="max-width: 800px;">
      <span class="close" onclick="closeAdminLeadModal()">&times;</span>
      <div style="margin-bottom: 16px;">
        <h2 id="admin-modal-lead-name" style="margin: 0;"></h2>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
        <div class="lead-details" style="padding: 0;">
          <p style="margin: 6px 0;"><strong>Contact:</strong> <span id="admin-modal-lead-contact"></span></p>
          <p style="margin: 6px 0;"><strong>Email:</strong> <span id="admin-modal-lead-email"></span></p>
          <p style="margin: 6px 0;"><strong>City:</strong> <span id="admin-modal-lead-city"></span></p>
          <p style="margin: 6px 0;"><strong>Source:</strong> <span id="admin-modal-lead-source"></span></p>
          <p style="margin: 6px 0;"><strong>Profession:</strong> <span id="admin-modal-lead-profession"></span></p>
          <p style="margin: 6px 0;"><strong>Current Status:</strong> <span id="admin-modal-lead-status"></span></p>
        </div>
        <div class="lead-details" style="padding: 0;">
          <div style="margin: 6px 0;">
            <strong>University:</strong>
            <div style="display: flex; gap: 8px; margin-top: 4px;">
              <input type="text" id="admin-modal-lead-university" style="flex: 1; padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 13px;">
              <button onclick="updateAdminLeadField('university')" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;"><i class="fas fa-save"></i></button>
            </div>
          </div>
          <div style="margin: 6px 0;">
            <strong>Course:</strong>
            <div style="display: flex; gap: 8px; margin-top: 4px;">
              <input type="text" id="admin-modal-lead-course" style="flex: 1; padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 13px;">
              <button onclick="updateAdminLeadField('course')" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;"><i class="fas fa-save"></i></button>
            </div>
          </div>
          <div style="margin-top: 12px;">
            <button onclick="copyAdminLeadDetails()" class="btn" style="padding: 6px 12px; font-size: 12px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; display: flex; align-items: center; gap: 4px; transition: all 0.2s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
              <i class="fas fa-copy" style="font-size: 11px;"></i> Copy All Details
            </button>
          </div>
        </div>
      </div>
      
      <!-- Update on Lead Section for Admin -->
      <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 16px; margin-bottom: 20px;">
        <h3 style="margin: 0 0 12px 0; color: #78350f; font-size: 15px; display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-bolt" style="color: #f59e0b;"></i>
          Update on Lead
        </h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
          <div class="form-group" style="margin-bottom: 0;">
            <label for="admin-quick-status" style="font-weight: 600; color: #78350f; margin-bottom: 4px; font-size: 12px;">Status (Optional):</label>
            <select id="admin-quick-status" style="width: 100%; padding: 8px; border: 2px solid #fcd34d; border-radius: 6px; font-size: 13px;">
              <option value="">-- Keep Current --</option>
              <option value="Fresh">Fresh</option>
              <option value="Buffer fresh">Buffer fresh</option>
              <option value="Did not pick">Did not pick</option>
              <option value="Request call back">Request call back</option>
              <option value="Follow up">Follow up</option>
              <option value="Counselled">Counselled</option>
              <option value="Interested in next batch">Interested in next batch</option>
              <option value="Registration fees paid">Registration fees paid</option>
              <option value="Enrolled">Enrolled</option>
              <option value="Junk/not interested">Junk/not interested</option>
            </select>
          </div>
          
          <div class="form-group" style="margin-bottom: 0;">
            <label for="admin-quick-datetime" style="font-weight: 600; color: #78350f; margin-bottom: 4px; font-size: 12px;">
              <i class="fas fa-phone" style="color: #f59e0b;"></i> Next Call:
            </label>
            <div style="display: flex; gap: 6px;">
              <input type="datetime-local" id="admin-quick-datetime" style="flex: 1; padding: 8px; border: 2px solid #fcd34d; border-radius: 6px; font-size: 13px;">
              <button type="button" onclick="clearAdminSchedule()" class="btn btn-secondary" style="padding: 6px 10px; font-size: 11px; white-space: nowrap;" title="Clear scheduled call">
                <i class="fas fa-times"></i> Clear
              </button>
            </div>
          </div>
          
          <div class="form-group" style="margin-bottom: 0;">
            <label for="transfer-user-select" style="font-weight: 600; color: #78350f; margin-bottom: 4px; font-size: 12px;">
              <i class="fas fa-exchange-alt" style="color: #f59e0b;"></i> Transfer:
            </label>
            <select id="transfer-user-select" style="width: 100%; padding: 8px; border: 2px solid #fcd34d; border-radius: 6px; font-size: 13px;">
              <option value="">-- Keep Current --</option>
            </select>
          </div>
        </div>
        
        <div class="form-group" style="margin-bottom: 12px;">
          <label for="admin-quick-note" style="font-weight: 600; color: #78350f; margin-bottom: 4px; font-size: 12px;">Follow-up Note (Optional):</label>
          <textarea id="admin-quick-note" placeholder="Add a note about this interaction..." rows="2" style="width: 100%; padding: 8px; border: 2px solid #fcd34d; border-radius: 6px; font-size: 13px; resize: vertical;"></textarea>
        </div>
        
        <div style="display: flex; gap: 10px;">
          <button onclick="quickUpdateAdminLead()" class="btn btn-primary" style="flex: 1; font-size: 15px; padding: 12px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none;">
            <i class="fas fa-check-circle"></i> Update Lead
          </button>
          <button onclick="deleteLead()" class="btn btn-danger" style="font-size: 15px; padding: 12px;">
            <i class="fas fa-trash-alt"></i> Delete
          </button>
        </div>
        <div id="transfer-message" class="message" style="display: none; margin-top: 12px;"></div>
      </div>
      
      <h3>Timeline & Activity</h3>
      <div id="admin-timeline-container" class="notes-list"></div>
    </div>
  </div>
  <!-- Status Leads Modal -->
  <div id="status-leads-modal" class="modal" style="display:none; z-index: 10001;">
    <div class="modal-content status-modal-content" onclick="event.stopPropagation()">
      <div class="modal-header-row">
        <h2 id="status-leads-title" class="modal-title"></h2>
        <button class="btn btn-secondary btn-sm" onclick="closeStatusLeadsModal()" style="min-width:80px;">Close</button>
      </div>
      <div id="status-leads-count" style="margin:4px 0 14px; font-size:13px; color:#6b7280;"></div>
      <div class="table-responsive" style="overflow-x:auto;">
        <table class="data-table compact" id="status-leads-table" style="table-layout: auto;">
          <thead>
            <tr>
              <th style="min-width: 120px;">Name</th>
              <th style="min-width: 110px;">Contact</th>
              <th style="min-width: 150px;">Email</th>
              <th style="min-width: 100px;">City</th>
              <th style="min-width: 140px;">University</th>
              <th style="min-width: 100px;">Course</th>
              <th style="min-width: 110px;">Profession</th>
              <th style="min-width: 80px;">Source</th>
              <th style="min-width: 120px;">Status</th>
              <th style="min-width: 110px;">Assigned To</th>
              <th style="min-width: 90px;">Updated</th>
            </tr>
          </thead>
          <tbody id="status-leads-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Status Distribution Drill-Down Modal -->
  <div id="status-distribution-modal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width: 1200px;" onclick="event.stopPropagation()">
      <span class="close" onclick="closeStatusDistributionModal()">&times;</span>
      <div style="margin-bottom: 16px;">
        <h2 id="status-distribution-title" style="margin: 0 0 8px 0; color: #1f2937;"></h2>
        <p id="status-distribution-subtitle" style="margin: 0; font-size: 14px; color: #6b7280;"></p>
      </div>
      
      <!-- Chart showing user distribution -->
      <div style="background: white; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 16px;">
        <h3 style="margin: 0 0 16px 0; color: #6366f1; font-size: 14px;">Distribution by User</h3>
        <canvas id="statusUserDistributionChart" style="max-height: 300px;"></canvas>
      </div>
      
      <!-- Toggle button for table -->
      <div style="margin-bottom: 12px;">
        <button id="toggle-status-table-btn" onclick="toggleStatusDistributionTable()" class="btn btn-secondary" style="padding: 8px 16px; font-size: 13px;">
          <i class="fas fa-table"></i> Show All Leads Table
        </button>
      </div>
      
      <!-- Table section (initially hidden) -->
      <div id="status-distribution-table-section" style="display: none;">
        <div style="background: white; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb;">
          <h3 style="margin: 0 0 12px 0; color: #6366f1; font-size: 14px;">All Leads</h3>
          <div class="table-responsive" style="overflow-x:auto; max-height: 400px; overflow-y: auto;">
            <table class="data-table compact" style="width: max-content; min-width: 100%;">
              <thead>
                <tr>
                  <th style="padding: 10px 20px; white-space: nowrap;">Name</th>
                  <th style="padding: 10px 20px; white-space: nowrap;">Contact</th>
                  <th style="padding: 10px 20px; white-space: nowrap;">Email</th>
                  <th style="padding: 10px 20px; white-space: nowrap;">City</th>
                  <th style="padding: 10px 20px; white-space: nowrap;">University</th>
                  <th style="padding: 10px 20px; white-space: nowrap;">Course</th>
                  <th style="padding: 10px 20px; white-space: nowrap;">Assigned To</th>
                  <th style="padding: 10px 20px; white-space: nowrap;">Updated</th>
                </tr>
              </thead>
              <tbody id="status-distribution-all-leads-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Detail Modal -->
  <div id="user-detail-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" onclick="closeUserDetailModal()">&times;</span>
      <h2 id="user-detail-name"></h2>
      <div class="lead-details">
        <p><strong>Email:</strong> <span id="user-detail-email"></span></p>
        <p><strong>Role:</strong> <span id="user-detail-role"></span></p>
        <p><strong>Created:</strong> <span id="user-detail-created"></span></p>
        <p><strong>Lead Count:</strong> <span id="user-detail-leads"></span></p>
      </div>
      <div class="info-box" style="margin-top:15px;">
        <h4>Password Reset</h4>
        <p style="margin-bottom:10px;">Set a new password for this user. Minimum 8 characters.</p>
        <div class="form-group" style="margin-bottom:12px;">
          <label for="reset-password-input">New Password</label>
          <input type="password" id="reset-password-input" placeholder="Enter new password">
        </div>
        <button class="btn btn-primary" onclick="resetUserPassword()">Reset Password</button>
        <div id="user-detail-reset-message" class="message" style="display:none; margin-top:12px;"></div>
        <p style="margin-top:15px; font-size:12px; color:#555;">Passwords are stored hashed; previous password cannot be retrieved.</p>
      </div>
      <div class="info-box" style="margin-top:15px;" id="admin-password-reset-section" style="display:none;">
        <h4>Reset Admin Password</h4>
        <p style="margin-bottom:10px;">Reset your own admin password. Minimum 8 characters.</p>
        <div class="form-group" style="margin-bottom:12px;">
          <label for="admin-reset-password-input">New Admin Password</label>
          <input type="password" id="admin-reset-password-input" placeholder="Enter new admin password">
        </div>
        <button class="btn btn-primary" onclick="resetAdminPassword()">Reset My Password</button>
        <div id="admin-reset-message" class="message" style="display:none; margin-top:12px;"></div>
      </div>
    </div>
  </div>

  <!-- Add Brochure Modal -->
  <div id="add-brochure-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
    <div style="background:white; border-radius:8px; padding:24px; width:90%; max-width:500px; box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0; font-size:20px; color:#111827;"><i class="fas fa-file-pdf" style="margin-right:8px; color:#e11d48;"></i>Add New Brochure</h2>
        <button onclick="closeAddBrochureModal()" style="background:none; border:none; font-size:24px; color:#9ca3af; cursor:pointer; padding:0; width:32px; height:32px;">&times;</button>
      </div>
      <form id="upload-brochure-form" enctype="multipart/form-data">
        <div class="form-group">
          <label for="brochure-university">University</label>
          <input type="text" id="brochure-university" name="university" required placeholder="e.g. Amity University">
        </div>
        <div class="form-group">
          <label for="brochure-course">Course</label>
          <input type="text" id="brochure-course" name="course" required placeholder="e.g. BBA">
        </div>
        <div class="form-group">
          <label for="brochure-file">Brochure PDF</label>
          <input type="file" id="brochure-file" name="file" accept="application/pdf" required>
        </div>
        <div style="display:flex; gap:12px; margin-top:20px;">
          <button type="submit" class="btn btn-primary" style="flex:1;">
            <i class="fas fa-upload"></i> Upload Brochure
          </button>
          <button type="button" onclick="closeAddBrochureModal()" class="btn btn-secondary" style="flex:1;">
            Cancel
          </button>
        </div>
      </form>
      <div id="upload-brochure-message" class="message" style="display:none; margin-top:16px;"></div>
    </div>
  </div>

  <!-- Create User Modal -->
  <div id="create-user-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
    <div style="background:white; border-radius:8px; padding:24px; width:90%; max-width:500px; box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0; font-size:20px; color:#111827;"><i class="fas fa-user-plus" style="margin-right:8px; color:#6366f1;"></i>Create New User</h2>
        <button onclick="closeCreateUserModal()" style="background:none; border:none; font-size:24px; color:#9ca3af; cursor:pointer; padding:0; width:32px; height:32px;">&times;</button>
      </div>
      <form id="create-user-form">
        <div class="form-group">
          <label for="new-user-name">Name</label>
          <input type="text" id="new-user-name" required placeholder="Full name">
        </div>
        
        <div class="form-group">
          <label for="new-user-email">Email</label>
          <input type="email" id="new-user-email" required placeholder="email@example.com">
        </div>
        
        <div class="form-group">
          <label for="new-user-password">Password</label>
          <input type="password" id="new-user-password" required placeholder="Minimum 8 characters">
        </div>
        
        <div class="form-group">
          <label for="new-user-confirm-password">Confirm Password</label>
          <input type="password" id="new-user-confirm-password" required placeholder="Re-enter password">
        </div>
        
        <div style="display:flex; gap:12px; margin-top:20px;">
          <button type="submit" class="btn btn-primary" style="flex:1;">
            <i class="fas fa-user-plus"></i> Create User
          </button>
          <button type="button" onclick="closeCreateUserModal()" class="btn btn-secondary" style="flex:1;">
            Cancel
          </button>
        </div>
      </form>
      
      <div id="create-user-message" class="message" style="display: none; margin-top:16px;"></div>
    </div>
  </div>

  <!-- Create Lead Modal -->
  <div id="create-lead-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center; overflow-y: auto;">
    <div style="background:white; border-radius:8px; padding:24px; width:90%; max-width:600px; box-shadow:0 20px 25px -5px rgba(0,0,0,0.1); margin: 20px auto;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0; font-size:20px; color:#111827;"><i class="fas fa-plus" style="margin-right:8px; color:#6366f1;"></i>Add New Lead</h2>
        <button onclick="closeCreateLeadModal()" style="background:none; border:none; font-size:24px; color:#9ca3af; cursor:pointer; padding:0; width:32px; height:32px;">&times;</button>
      </div>
      <form id="create-lead-form">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">
          <div class="form-group">
            <label for="lead-name">Name <span style="color: #dc2626;">*</span></label>
            <input type="text" id="lead-name" required placeholder="Full name">
          </div>
          
          <div class="form-group">
            <label for="lead-contact">Contact <span style="color: #dc2626;">*</span></label>
            <input type="text" id="lead-contact" required placeholder="Phone number">
          </div>
        </div>

        <div class="form-group">
          <label for="lead-email">Email</label>
          <input type="email" id="lead-email" placeholder="email@example.com">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">
          <div class="form-group">
            <label for="lead-city">City</label>
            <input type="text" id="lead-city" placeholder="City">
          </div>
          
          <div class="form-group">
            <label for="lead-profession">Profession</label>
            <input type="text" id="lead-profession" placeholder="Profession">
          </div>
        </div>

        <div class="form-group">
          <label for="lead-source">Source</label>
          <select id="lead-source" onchange="toggleAdminCustomSource()">
            <option value="Other">Other</option>
            <option value="Meta">Meta</option>
            <option value="Google">Google</option>
            <option value="LinkedIn">LinkedIn</option>
            <option value="Instagram">Instagram</option>
            <option value="Facebook">Facebook</option>
            <option value="Direct">Direct</option>
            <option value="Referral">Referral</option>
            <option value="Website">Website</option>
            <option value="__custom__">+ Add Custom Source</option>
          </select>
          <input type="text" id="lead-custom-source" placeholder="Enter custom source name..." style="display: none; margin-top: 8px;">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">
          <div class="form-group">
            <label for="lead-university">University</label>
            <input type="text" id="lead-university" placeholder="University">
          </div>
          
          <div class="form-group">
            <label for="lead-course">Course</label>
            <input type="text" id="lead-course" placeholder="Course">
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">
          <div class="form-group">
            <label for="lead-status">Status</label>
            <select id="lead-status">
              <option value="Fresh">Fresh</option>
              <option value="Buffer fresh">Buffer fresh</option>
              <option value="Did not pick">Did not pick</option>
              <option value="Request call back">Request call back</option>
              <option value="Follow up">Follow up</option>
              <option value="Counselled">Counselled</option>
              <option value="Interested in next batch">Interested in next batch</option>
              <option value="Registration fees paid">Registration fees paid</option>
              <option value="Enrolled">Enrolled</option>
              <option value="Junk/not interested">Junk/not interested</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="lead-assigned-to">Assign To <span style="color: #dc2626;">*</span></label>
            <select id="lead-assigned-to" required>
              <option value="">Select user...</option>
            </select>
          </div>
        </div>
        
        <div style="display:flex; gap:12px; margin-top:20px;">
          <button type="submit" class="btn btn-primary" style="flex:1;">
            <i class="fas fa-plus"></i> Create Lead
          </button>
          <button type="button" onclick="closeCreateLeadModal()" class="btn btn-secondary" style="flex:1;">
            Cancel
          </button>
        </div>
      </form>
      
      <div id="create-lead-message" class="message" style="display: none; margin-top:16px;"></div>
    </div>
  </div>
  
  <!-- Loading Overlay with Progress -->
  <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 9999; backdrop-filter: blur(4px);">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px 40px; border-radius: 12px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); min-width: 320px; text-align: center;">
      <div style="margin-bottom: 20px;">
        <div style="width: 60px; height: 60px; border: 4px solid #e5e7eb; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
      </div>
      <div id="loading-message" style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 8px;">Processing...</div>
      <div id="loading-submessage" style="font-size: 13px; color: #6b7280;">Please wait while we apply your changes</div>
      <div id="progress-bar-container" style="margin-top: 16px; background: #e5e7eb; border-radius: 8px; height: 8px; overflow: hidden; display: none;">
        <div id="progress-bar" style="background: linear-gradient(90deg, #3b82f6, #8b5cf6); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
      </div>
    </div>
  </div>
  
  <!-- Confirmation Modal -->
  <div id="confirmation-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 9998; backdrop-filter: blur(2px);">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 24px; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3); min-width: 400px; max-width: 500px;">
      <div style="margin-bottom: 16px;">
        <h3 id="confirm-title" style="font-size: 18px; font-weight: 600; color: #1f2937; margin: 0 0 8px 0;">Confirm Action</h3>
        <p id="confirm-message" style="font-size: 14px; color: #6b7280; margin: 0; line-height: 1.5;"></p>
      </div>
      <div style="display: flex; gap: 12px; justify-content: flex-end;">
        <button onclick="closeConfirmModal()" class="btn" style="padding: 8px 16px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db;">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button id="confirm-action-btn" class="btn btn-primary" style="padding: 8px 16px;">
          <i class="fas fa-check"></i> Confirm
        </button>
      </div>
    </div>
  </div>
  
  <!-- Filtered Leads Graph Modal -->
  <div id="filtered-leads-graph-modal" class="modal" style="display:none; z-index: 10001; background: rgba(0, 0, 0, 0.4); backdrop-filter: none; justify-content: flex-end; padding: 0; align-items: stretch;" onclick="closeFilteredLeadsGraphModal()">
    <div class="modal-content" style="max-width: 600px; width: 600px; max-height: 100vh; margin: 0; border-radius: 0 12px 12px 0; box-shadow: -8px 0 24px rgba(0,0,0,0.15); animation: slideInFromRight 0.3s ease-out; overflow-y: auto;" onclick="event.stopPropagation()">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #1f2937;">Status Distribution - Filtered Leads</h2>
        <button onclick="closeFilteredLeadsGraphModal()" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
      <div style="position: relative; height: 400px; margin-bottom: 20px;">
        <canvas id="filtered-leads-chart"></canvas>
      </div>
      <div id="graph-summary" style="background: #f9fafb; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb;">
        <h4 style="margin: 0 0 12px 0; color: #6366f1;">Summary Statistics</h4>
        <div id="graph-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
          <!-- Stats will be populated here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- User Distribution Popup for Filtered Leads -->
  <div id="filtered-user-distribution-modal" class="modal" style="display:none; z-index: 10002; background: rgba(0, 0, 0, 0.3); backdrop-filter: none; justify-content: flex-start; padding: 0; align-items: stretch;" onclick="closeFilteredUserDistributionModal()">
    <div class="modal-content" style="max-width: 600px; width: 600px; max-height: 100vh; margin: 0; border-radius: 0 12px 12px 0; box-shadow: 8px 0 24px rgba(0,0,0,0.15); animation: slideInFromLeftModal 0.3s ease-out; overflow-y: auto;" onclick="event.stopPropagation()">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 id="filtered-user-dist-title" style="margin: 0; color: #1f2937;">User Distribution</h2>
        <button onclick="closeFilteredUserDistributionModal()" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
      <div style="position: relative; height: 400px; margin-bottom: 20px;">
        <canvas id="filtered-user-distribution-chart"></canvas>
      </div>
      <div id="filtered-user-dist-summary" style="background: #f9fafb; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb;">
        <h4 style="margin: 0 0 12px 0; color: #6366f1;">Summary</h4>
        <div id="filtered-user-dist-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
          <!-- Stats will be populated here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Success/Error Toast -->
  <div id="toast-notification" style="display: none; position: fixed; top: 80px; right: 20px; background: white; padding: 16px 20px; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2); z-index: 10000; min-width: 300px; max-width: 400px; border-left: 4px solid #10b981;">
    <div style="display: flex; align-items: start; gap: 12px;">
      <i id="toast-icon" class="fas fa-check-circle" style="font-size: 20px; color: #10b981; margin-top: 2px;"></i>
      <div style="flex: 1;">
        <div id="toast-title" style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">Success</div>
        <div id="toast-message" style="font-size: 13px; color: #6b7280; line-height: 1.4;"></div>
      </div>
      <button onclick="closeToast()" style="background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 18px; padding: 0; line-height: 1;">×</button>
    </div>
  </div>
  
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    #toast-notification {
      animation: slideIn 0.3s ease-out;
    }
  </style>
  
  <!-- Footer -->
  <footer style="position:fixed; bottom:0; left:260px; right:0; padding:10px 20px; background:rgba(249,250,251,0.95); border-top:1px solid #e5e7eb; font-size:11px; color:#6b7280; text-align:center; z-index:100; backdrop-filter: blur(8px);">
    <span>© 2025 DegreeDrishti. All rights reserved.</span>
    <span style="margin-left:16px; color:#9ca3af;">Developed by Samarth</span>
  </footer>
  
  <script src="js/config.js?v=3.0" defer></script>
  <script src="js/admin.js?v=3.0" defer></script>
</body>
</html>
